<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">



	<title>Diper</title>
</head>
<header style="background-color: #ffffff;">
	<div fxLayout="row" fxLayoutAlign="start center" class="clase1" style="background-color: #ffffff;">
		<div class="clase2" fxFlex="30" >
			<img fxFlex="100" src="assets/logodiper.png" alt="Diper" style="height: 75%; width: 75%">
    </div>
    <div fxFlex=40></div>
    <div class="clase3" style="top:20px" fxFlex="30" fxLayoutAlign="end center">
      
      
            <mat-form-field fxFlex="50" appearance="outline" style="padding-right: 15px;
            padding-left: 15px;">
              <mat-label>Fecha</mat-label>
              <input matInput placeholder="Fecha" value="{{jsfecha}}" readonly="true">
            </mat-form-field>          
           
            <mat-form-field fxFlex="50" appearance="outline" style="padding-right: 15px; padding-left: 15px;">
              <mat-label>Pedido</mat-label>
              <input matInput placeholder="Fecha" value="{{jsfecha}}" readonly="true">
            </mat-form-field>
            
      

    </div>
    
  
  </div>
</header>

<body  style="background-color: #c7e6a7; height: 100%;">
  <br><br><br>


  <div class="clase5" style="background-color: white; top:20px; ">
    <div fxLayout="row" fxLayoutAlign="start center">
    <label fxFlex="60" style="top: 20px; width:auto; font-size:26px; font-weight: bold;">Ingrese su numero de Agente</label>
    
        <mat-form-field fxFlex="20" appearance="standard" style="top:10px;margin-left: auto; width:auto !important; padding-right: 4%;">
          <mat-label>No. Agente</mat-label>
          <input matInput #NoAgente placeholder="Formato: ###" value="" readonly="false">            
        </mat-form-field>
        <button #buscar fxFlex="10" color=accent *ngIf="!visibilidad2" mat-flat-button (click)="visibilidad2 = !visibilidad2; optionsC=[]; getAgente(NoAgente.value)">{{visibilidad2 ? 'Ocultar' : 'Buscar'}}</button>
        <button #ocultar fxFlex="10" color=accent *ngIf="visibilidad2" mat-flat-button (click)="visibilidad2 = !visibilidad2; agente=null;">{{visibilidad2 ? 'Ocultar' : 'Buscar'}}</button>
      </div>
      <hr>
      
    <br>
    <form name="list_Clientes" *ngIf="visibilidad2 && existe2">
    
      <mat-form-field appearance="standard" fxFlex="60" style="padding-right: 6%">
      <mat-label>Clientes</mat-label>                  
        <input type="text" #clienteLista disabled=true placeholder="Seleccion" matInput [formControl]="myControl2" [matAutocomplete]="auto2">
        <mat-autocomplete panelWidth="400px" #auto2="matAutocomplete"  (optionSelected)="banderaCliente=true;NoCliente.value=fillCliente(clienteLista.value)" >                                
            <mat-option *ngFor="let option of filteredClients | async" [value]="option" >
              {{option}}
                </mat-option>  

        
          </mat-autocomplete>

      </mat-form-field>
      <mat-form-field #formIdCliente fxFlex="20" appearance="standard" style="top:10px;margin-left: auto; width:auto !important; padding-right: 4%;">
          <mat-label>No. Cliente</mat-label>
          <input matInput #NoCliente placeholder="Numero de Cliente" value="" readonly="true">            
        </mat-form-field>
        <button #buscar style="height:40px; top:20px" fxFlex="10" color=accent *ngIf="!visibilidad && NoCliente.value!=''" mat-flat-button (click)="visibilidad = !visibilidad; getClientes(NoCliente.value)">{{visibilidad ? 'Ocultar' : 'Buscar'}}</button>
        <button #ocultar style="height:40px; top:20px" fxFlex="10" color=accent *ngIf="visibilidad && NoCliente.value!=''" mat-flat-button (click)="visibilidad = !visibilidad; Cliente=null;">{{visibilidad ? 'Ocultar' : 'Buscar'}}</button>          
    </form>
    
  </div>
  
  <div class="clase5" style="background-color: white; "  *ngIf="existe">
     
    <form name="datos_Cliente" *ngIf="visibilidad && existe">
      <br>
      <h3>Datos del cliente</h3>
      <mat-form-field appearance="standard" style="width:47% !important; padding-right: 6%">
      <mat-label>Nombre</mat-label>
      <input #cliente matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Nombre}} {{clientes.cliente[0].Cln_Apellido}}" readonly="true">            
    </mat-form-field>
    <mat-form-field appearance="standard" style="width:47% !important; padding-right: 0%">
      <mat-label>RFC</mat-label>
      <input #rfc matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_RFC}}" readonly="true">            
    </mat-form-field>
    <mat-form-field appearance="standard" style="width:47% !important; padding-right: 6%">
      <mat-label>Domicilio</mat-label>
      <input #domicilio matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Direccion}}" readonly="true">            
    </mat-form-field>
    <mat-form-field appearance="standard" style="width:47% !important; padding-right: 0%">
        <mat-label>Colonia</mat-label>
        <input #colonia matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Colonia}}" readonly="true">
      </mat-form-field>
      <mat-form-field appearance="standard" style="width:47% !important; padding-right: 6%">
          <mat-label>Ciudad</mat-label>
          <input #ciudad matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Ciudad}}" readonly="true">
        </mat-form-field>
        <mat-form-field appearance="standard" style="width:47% !important; padding-right: 0%">
            <mat-label>Estado</mat-label>
            <input #estado matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Estado}}" readonly="true">            
          </mat-form-field>
          <mat-form-field appearance="standard" style="width:47% !important; padding-right: 6%">
              <mat-label>Telefono</mat-label>
              <input #telefono matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_TelCom}}" readonly="true">            
            </mat-form-field>
            <mat-form-field appearance="standard" style="width:47% !important; padding-right: 0%">
                <mat-label>Compa√±ia</mat-label>
                <input #persona matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Compania}}" readonly="true">            
              </mat-form-field>
              <mat-form-field appearance="standard" style="width:47% !important; padding-right: 6%">
                  <mat-label>Consignar</mat-label>
                  <input #consignar matInput placeholder="Fecha" value="Nombre" readonly="true">            
                </mat-form-field>
                <mat-form-field appearance="standard" style="width:47% !important; padding-right: 0%">
                    <mat-label>E-mail</mat-label>
                    <input #email matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_Email}}" readonly="true">            
                  </mat-form-field>  
          <h3>Descuentos aplicables</h3>          
          <mat-form-field appearance="standard" style="width:22% !important; padding-right: 3%">
            <mat-label>Descuento pactado</mat-label>
            <input #desc1 matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_DescuentoPactado}}" readonly="true">            
          </mat-form-field>
          <mat-form-field appearance="standard" style="width:22% !important; padding-right: 3%">
            <mat-label>Descuento pronto pago</mat-label>
            <input #desc2 matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_DescuentoProntoPago}}" readonly="true">            
          </mat-form-field>
          <mat-form-field appearance="standard" style="width:22% !important; padding-right: 3%">
            <mat-label>Descuento recoger origen</mat-label>
            <input #desc3 matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_DescuentoRecogerOrigen}}" readonly="true">            
          </mat-form-field>
          <mat-form-field appearance="standard" style="width:22% !important; padding-right: 3%">
            <mat-label>Descuento opcional</mat-label>
            <input #desc4 matInput placeholder="Fecha" value="{{clientes.cliente[0].Cln_DescuentoOpcional}}" readonly="true">            
          </mat-form-field>
    </form>
  </div>

  <br><br>
  <div *ngIf="visibilidad && existe" class="clase5" style="background-color: white; top:20px" >
    <div fxLayout="row" fxLayoutAlign="start center">
      <label style="top: 20px; width:40%; font-size:26px; font-weight: bold">Pedido</label>
    
      <mat-form-field appearance="standard" style="top:10px;margin-left: auto; width:17% !important; padding-right: 4%;visibility: hidden">
        <mat-label>No. Cliente</mat-label>
        <input matInput placeholder="Fecha" value="Nombre" readonly="true" >                    
      </mat-form-field>
      
      <button fxFlex="10" color=accent style="margin-left: 10px" mat-flat-button (click)="muebles.push(0);myControl.value='';options=[]; banderaPdf=false; importe.push(0); resize()" *ngIf="datosMueble.length==muebles.length">+</button>
      <button fxFlex="10" color=warn style="margin-left: 10px" mat-flat-button (click)="muebles.pop(muebles.length); datosMueble.pop(datosMueble.length); importenew.pop(importenew.length); importe.pop(importe.length);banderaPdf=false" *ngIf="muebles.length>0">-</button>    
      </div>
      <hr>
    
    <div fxLayout="row" fxLayoutAlign="space-evenly center" style="text-align: center; font-weight: bold" >
      <div fxFlex="1"></div>
      <div style="padding-right:5%"fxFlex="15">Pz/Jg</div>
      <div style="padding-right:5%"fxFlex="15">Cant.</div>
      <div style="padding-right:5%"fxFlex="35">Descripcion</div>
      <div style="padding-right:5%"fxFlex="15">Precio Unit.</div>
      <div fxFlex="10">Importe</div>
      <div fxFlex="1"></div>
      
    </div>
    <hr>
    <div *ngFor="let index of muebles;let m = index">
      <div fxLayout="row" fxLayoutAlign="space-evenly center">
        <div fxFlex="1"></div>


        <mat-form-field fxFlex="15" name="Mueble" appearance="fill" style="text-align:center;padding-right:5%">
          <mat-select #tipo placeholder=Tipo (selectionChange)="fillOptions(tipo.value); descripcion.disabled=false; descripcion.value=''">
            <mat-option value=Pieza>            
            Pieza
            </mat-option>
            <mat-option value="Juego">            
            Juego
            </mat-option>
          </mat-select>
        </mat-form-field>
        

        <mat-form-field fxFlex="15" style="padding-right:5% ">          
          <input matInput #cant placeholder="Cantidad" type="number" min="0" value="0" (valueChanges)="setCantidad(cant.value, m)" readonly="false">            
        </mat-form-field>
        <mat-form-field fxFlex="35" appearance="fill"style="padding-right:5%;">                    
          <input type="text" #descripcion disabled=true placeholder="Seleccion" matInput [formControl]="myControl" [matAutocomplete]="auto">
          <mat-autocomplete panelWidth="400px" #auto="matAutocomplete"  (optionSelected)="getPrecio(descripcion.value, clientes.cliente[0].Lpr_Clave, m, tipo.value); descripcion.disabled=true" >                                
          
            <ng-container *ngIf="tipo.value !=null">
            <ng-container *ngIf="tipo.value=='Pieza';then pieza; else juego">
            </ng-container>
          </ng-container>
            <ng-template #pieza>
              <mat-option *ngFor="let option of filteredOptions | async" [value]="option" >
                {{option}}
                  </mat-option>  
              <!--<mat-option  *ngFor="let index of piezas; let i = index" value={{piezas[i].Pzs_Descripcion}}>            
                    {{piezas[i].Pzs_Descripcion}}
                  </mat-option>-->
            </ng-template>
            
              <ng-template #juego>
                <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                  {{option}}
                    </mat-option>
                <!--<mat-option  *ngFor="let index of juegos; let i = index" value={{juegos[i].Jgs_Descripcion}}>            
                    {{juegos[i].Jgs_Descripcion}}
                  </mat-option>-->
              </ng-template>
          
            </mat-autocomplete>

        </mat-form-field>
        <mat-form-field fxFlex="15" appearance="fill"style="padding-right:5%">
          <input matInput placeholder="Precio" value="{{importe[m]}}" readonly="true">            
        </mat-form-field>
        <mat-form-field fxFlex="10" appearance="fill">
          <input matInput #imp  placeholder="Importe" value={{importe[m]*cant.value}} (valueChanges)="calcImporte(imp.value, m);" >            
          {{calcTodo(m, tipo.value, cant.value, descripcion.value, imp.value)}}
          
        </mat-form-field>
        <div fxFlex="1"></div>
      </div>
        <!--<label fxFlex="20">
          Alias:
          <input type="text" [formControlName]="i">
        </label>  

      -->

        
      
      
    </div>
    <div fxLayout="row" fxLayoutAlign="space-evenly center" style="text-align: center;" >
      <div fxFlex="1"></div>
      <div style="padding-right:5%"fxFlex="15" fxFlex.lt-md="5"></div>
      <div style="padding-right:5%"fxFlex="15"fxFlex.lt-md="5"></div>
      <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="15"></div>
      <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="40">Importe Total:</div>
      <div fxFlex="10"fxFlex.lt-md="25">{{tot | currency:'MXN'}}</div>
      <div fxFlex="1"></div>
      
    </div>
    <div fxLayout="row" fxLayoutAlign="space-evenly center" style="text-align: center; " *ngIf="desctot>0" >
        <div fxFlex="1"></div>
        <div style="padding-right:5%"fxFlex="15" fxFlex.lt-md="5"></div>
        <div style="padding-right:5%"fxFlex="15"fxFlex.lt-md="5"></div>
        <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="15"></div>
        <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="40">Descuento:</div>
        <div fxFlex="10"fxFlex.lt-md="25">{{tot-desctot | currency:'MXN'}}</div>
        <div fxFlex="1"></div>
        
      </div>
      <div fxLayout="row" fxLayoutAlign="space-evenly center" style="text-align: center; " *ngIf="desctot>0">
          <div fxFlex="1"></div>
          <div style="padding-right:5%"fxFlex="15" fxFlex.lt-md="5"></div>
          <div style="padding-right:5%"fxFlex="15"fxFlex.lt-md="5"></div>
          <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="15"></div>
          <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="40">Total con Descuento:</div>
          <div fxFlex="10"fxFlex.lt-md="25">{{desctot | currency:'MXN'}}</div>
          <div fxFlex="1"></div>
          
        </div>
        <div fxLayout="row" fxLayoutAlign="space-evenly center" style="text-align: center; " >
            <div fxFlex="1"></div>
            <div style="padding-right:5%"fxFlex="15" fxFlex.lt-md="5"></div>
            <div style="padding-right:5%"fxFlex="15"fxFlex.lt-md="5"></div>
            <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="15"></div>
            <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="40">IVA</div>
            <div fxFlex="10"fxFlex.lt-md="25" *ngIf="desctot>0">{{desctot*iva/100 | currency:'MXN'}}</div>
            <div fxFlex="10"fxFlex.lt-md="25" *ngIf="desctot==0">{{tot*iva/100 | currency:'MXN'}}</div>
            <div fxFlex="1"></div>
            
          </div>
          <div fxLayout="row" fxLayoutAlign="space-evenly center" style="text-align: center; font-weight: bold" >
              <div fxFlex="1"></div>
              <div style="padding-right:5%"fxFlex="15" fxFlex.lt-md="5"></div>
              <div style="padding-right:5%"fxFlex="15"fxFlex.lt-md="5"></div>
              <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="15"></div>
              <div style="padding-right:5%"fxFlex="25"fxFlex.lt-md="40">Total con IVA:</div>
              <div fxFlex="10"fxFlex.lt-md="25" *ngIf="desctot>0">{{desctot+desctot*iva/100 | currency:'MXN'}}</div>
              <div fxFlex="10"fxFlex.lt-md="25" *ngIf="desctot==0">{{tot+tot*iva/100 | currency:'MXN'}}</div>
              <div fxFlex="1"></div>
              
            </div>
    <hr>
    <div *ngIf="datosMueble.length>0">
    <div class="sig-container" id="signature-pad" #signpad>
      <div class="sig-body">
          <signature-pad [options]="signaturePadOptions" #campoFirma></signature-pad>
      </div>  
      
        <br>
      </div>
      <div fxLayout="row" fxLayoutAlign="space-evenly center">
          <button fxFlex="10"fxFlex.lt-md="35" color=accent style="text-align: center; margin-right: 10px" mat-flat-button (click)="getFirma()" >Confirmar</button>              
          <button fxFlex="10"fxFlex.lt-md="35" color=accent style="text-align: center" mat-flat-button (click)="banderaFirma=false; drawClear();">Limpiar</button>              
        </div>
        
    <hr>
  </div>
    <div fxLayout="row" fxLayoutAlign="space-evenly center">
      
      <button fxFlex="10"fxFlex.lt-md="35" color=accent style="text-align: center;margin-right: 10px" mat-flat-button (click)="genPDF()" *ngIf="banderaFirma">Generar PDF</button>          
      
      <button fxFlex="10"fxFlex.lt-md="35" color=accent style="text-align: center" mat-flat-button (click)="sendPDF()" *ngIf="banderaPdf">Enviar PDF</button>
      
    </div>
<br>
    </div>
  
 <br><br><br>
</body>
<footer>
</footer>
</html>